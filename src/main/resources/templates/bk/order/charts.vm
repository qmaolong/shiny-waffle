<!DOCTYPE html>
<html>
<head>
    #parse("templates/common/base-bk.vm")
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>$TITLE</title>
     <link href="$URL/asset/bk/css/bootstrap.min14ed.css?v=3.3.6" rel="stylesheet">
    <link href="$URL/asset/bk/css/font-awesome.min93e3.css?v=4.4.0" rel="stylesheet">

    <link href="$URL/asset/bk/css/animate.min.css" rel="stylesheet">
    <link href="$URL/asset/bk/css/style.min862f.css?v=4.1.0" rel="stylesheet">

</head>

<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="ibox-content m-b-sm border-bottom">
        <div class="p-xs">
            <div class="pull-left m-r-md">
                <i class="fa fa-globe text-navy mid-icon"></i>
            </div>
            <h2>欢迎来到克维拉收银系统后台</h2>
            <span>你可以查看、管理门店数据。</span>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-3">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-success pull-right month">月</span>
                    <h5>营业收入</h5>
                </div>
                <div class="ibox-content">
                    <h1 class="no-margins" id="monthIncome">0</h1>
                    <div class="stat-percent font-bold text-success"></i>
                    </div>
                    <small>元</small>
                </div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-success pull-right month">月</span>
                    <h5>订单</h5>
                </div>
                <div class="ibox-content">
                    <h1 class="no-margins" id="monthOrderCount">0</h1>
                    <div class="stat-percent font-bold text-info"></i>
                    </div>
                    <small>订单数</small>
                </div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-success pull-right month">月</span>
                    <h5>客流量</h5>
                </div>
                <div class="ibox-content">
                    <h1 class="no-margins" id="monthPeople">0</h1>
                    <div class="stat-percent font-bold text-navy"> </i>
                    </div>
                    <small>人次</small>
                </div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-danger pull-right">今天</span>
                    <h5>客流量</h5>
                </div>
                <div class="ibox-content">
                    <h1 class="no-margins" id="dayPeople">0</h1>
                    <div class="stat-percent font-bold text-danger"></i>
                    </div>
                    <small>人次</small>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>一周门店流水</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        #*<a class="dropdown-toggle" data-toggle="dropdown" href="graph_flot.html#">
                            <i class="fa fa-wrench"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-user">
                            <li><a href="graph_flot.html#">选项1</a>
                            </li>
                            <li><a href="graph_flot.html#">选项2</a>
                            </li>
                        </ul>*#
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="echarts" id="echarts-line-chart"></div>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>一周菜品销售排行</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        #*<a class="dropdown-toggle" data-toggle="dropdown" href="graph_flot.html#">
                            <i class="fa fa-wrench"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-user">
                            <li><a href="graph_flot.html#">选项1</a>
                            </li>
                            <li><a href="graph_flot.html#">选项2</a>
                            </li>
                        </ul>*#
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">

                    <div class="echarts" id="echarts-bar-chart"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="$URL/asset/bk/js/jquery.min.js?v=2.1.4"></script>
<script src="$URL/asset/bk/js/bootstrap.min.js?v=3.3.6"></script>
<script src="$URL/asset/bk/js/plugins/echarts/echarts-all.js"></script>
<script src="$URL/asset/bk/js/plugins/layer/layer.min.js"></script>
<script src="$URL/asset/bk/js/content.min.js"></script>
<script type="text/javascript">
    $(function(){
        layer.load(0, {
            shade: [0.1,'#fff'] //0.1透明度的白色背景
        });
        jQuery.ajax({
            url : '$URL/merchant/admin/order/getChartsData',
            type : 'get',
            success : function(res){
                initPageCharts(res);
                layer.closeAll("loading");
            }
        })
    })

    function initPageCharts(data){
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('echarts-line-chart'));
        var myChart2 = echarts.init(document.getElementById('echarts-bar-chart'));
        $("#monthIncome").text(data.monthIncome);
        $("#monthOrderCount").text(data.monthOrderCount);
        $("#monthPeople").text(data.monthPeople);
        $("#dayPeople").text(data.dayPeople);
        $(".month").text(data.month + "月");

        // 指定图表的配置项和数据
        option = {
            title : {
                text: '',//一周销售情况(' + data.weekData.days[data.weekData.days.length-1] + '~' + data.weekData.days[0] + ')
                subtext: ''
            },
            tooltip : {
                trigger: 'axis'
            },
            legend: {
                data:[]
            },
            toolbox: {
                show : true,
                feature : {
                    mark : {show: false},
                    dataView : {show: true, readOnly: false},
                    magicType : {show: true, type: ['line', 'bar']},
                    restore : {show: true},
                    saveAsImage : {show: true}
                }
            },
            calculable : true,
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : false,
                    data : data.weekData.days.reverse(),
                    axisLabel: {
                        interval: 0,
                        rotate: -15
                    }
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    axisLabel : {
                        formatter: '{value} 元'
                    }
                }
            ],
            series : [
                {
                    name:'总收入',
                    type:'line',
                    data:data.weekData.amounts.reverse(),
                    markPoint : {
                        data : [
                            {type : 'max', name: '最大值'},
                            {type : 'min', name: '最小值'}
                        ]
                    },
                    markLine : {
                        data : [
                            {type : 'average', name: '平均值'}
                        ]
                    }
                }
            ],
            grid : {x: '12%', y: '18%', width: '75%', height: '60%'}
        };

        //构造数据
        if (data.weekFood.values.length == 0){
            data.weekFood.values = ["0"];
            data.weekFood.names = ["暂无数据"]
        }

        option2 = {
            title : {
                text: '',//一周菜品销售排行
                subtext: ''
            },
            tooltip : {
                trigger: 'axis'
            },
            legend: {
                data:[]
            },
            toolbox: {
                show : true,
                feature : {
                    dataView : {show: true, readOnly: false},
                    saveAsImage : {show: true}
                }
            },
            calculable : true,
            xAxis : [
                {
                    type : 'category',
                    data : data.weekFood.names,
                    axisLabel: {
                        interval: 0,
                        rotate: -22,
                        /*formatter: function (val) {
                            return val.split("").join("\n");
                        }*/
                    }
                }
            ],
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [
                {
                    name:'销售量',
                    type:'bar',
                    data:data.weekFood.values,
                }
            ],
            noDataLoadingOption :{
                text: '暂无数据',
                effect:'bubble',
                textStyle: {
                    fontSize: 20,
                    fontWeight: 'bold'
                }
            },
            color : ['#339933'],
            grid : {x: '8%', y: '15%', width: '82%', height: '60%'}
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
        if (data.weekFood.values.length > 0){
            myChart2.setOption(option2);
        }else {
            $("#echarts-bar-chart").html("<span style='margin-left:45%'>暂无数据</span>")
        }
    }


</script>
</body>
</html>
